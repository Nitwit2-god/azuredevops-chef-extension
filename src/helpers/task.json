{
  "id": "e96c7e8c-aca1-4eaa-ac86-78e0d639e81f",
  "name": "helper",
  "friendlyName": "Chef Helpers",
  "description": "This task contains helper tasks, such as updating your cookbook version, which are not accommodated by the other tasks",
  "helpMarkDown": "[More Information](https://chef-partners.github.io/azuredevops-chef-extension/docs/tasks/helpers.html",
  "category": "Azure Pipelines",
  "author": "Chef",
  "version": {
    "Major": 2,
    "Minor": 0,
    "Patch": 15
  },
  "instanceNameFormat": "Helper: $(helper)",
  "groups": [
    {
      "name": "advanced",
      "displayName": "Advanced",
      "isExpanded": false
    }
  ],
  "inputs": [
    {
      "name": "helper",
      "type": "picklist",
      "label": "Helpers",
      "defaultValue": "",
      "helpMarkDown": "Select the Helper to use for this task",
      "options": {
        "setCookbookVersion": "Set Cookbook Version Number",
        "setupHabitat": "Setup Habitat Environment",
        "envCookbookVersion": "Set Cookbook Version on Chef Environment",
        "setupChef": "Setup Chef"
      },
      "required": true
    },
    {
      "name": "cookbookVersionNumber",
      "type": "string",
      "label": "Version Number",
      "defaultValue": "$(Build.BuildNumber)",
      "helpMarkDown": "Version number to apply to the metadata of the cookbook. By default this is set to the build number of the run.",
      "visibleRule": "helper == setCookbookVersion"
    },
    {
      "name": "cookbookMetadataPath",
      "type": "string",
      "label": "Cookbook Metadata File",
      "defaultValue": "$(Build.SourcesDirectory)/metadata.rb",
      "helpMarkDown": "Path to the `metadata.rb` file for the cookbook",
      "visibleRule": "helper == setCookbookVersion"
    },
    {
      "name": "cookbookVersionRegex",
      "type": "string",
      "label": "Version Regex",
      "defaultValue": "version\\s+['\"]?.*['\"]?",
      "helpMarkDown": "Regular Expression to be used in the `metadata.rb` file to set the version number",
      "visibleRule": "helper == setCookbookVersion"
    },
    {
      "name": "habitatOrigin",
      "type": "connectedService:habitatoriginendpointv1",
      "label": "Habitat Origin",
      "defaultValue": "",
      "visibleRule": "helper == setupHabitat",
      "helpMarkDown": "The Habitat Origin endpoint that contains the necessary origin name, revision and keys"
    },
    {
      "name": "sudo",
      "type": "boolean",
      "label": "Use Sudo",
      "defaultValue": false,
      "helpMarkdown": "Use Sudo to perform the installation. (Only valid on Linux build agents).",
      "groupName": "advanced"
    },
    {
      "name": "chefendpoint",
      "type": "connectedService:chefendpointv1",
      "label": "Endpoint",
      "defaultValue": "",
      "visibleRule": "helper = envVersionConstraint || helper = setupChef",
      "helpMarkdown": "Select the endpoint to use when communicating with the Chef server",
      "required": false
    },
    {
      "name": "environmentName",
      "type": "string",
      "label": "Chef environment",
      "defaultValue": "",
      "required": false,
      "visibleRule": "helper = envVersionConstraint",
      "helpMarkDown": "Name of the Chef environment to modify"
    },
    {
      "name": "cookbookName",
      "type": "string",
      "label": "Cookbook name",
      "defaultValue": "",
      "required": true,
      "visibleRule": "helper = envVersionConstraint",
      "helpMarkDown": "Name of the target cookbook"
    },
    {
      "name": "cookbookVersionNumber",
      "type": "string",
      "label": "Cookbook version",
      "defaultValue": "$(Build.BuildNumber)",
      "required": true,
      "visibleRule": "helper = envVersionConstraint",
      "helpMarkDown": "Version of the cookbook to pin"
    }
  ],
  "execution": {
    "Node": {
      "target": "helpers.js"
    }
  }
}